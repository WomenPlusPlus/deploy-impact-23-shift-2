<div class="flex flex-col items-stretch justify-center lg:max-w-screen-lg p-6 mx-auto" *ngIf="vm$ | async as vm">
    <ng-container *ngIf="!vm.submitted; else submittedContainer">
        <h1 class="text-3xl mb-3">Send an invitation</h1>
        <form [formGroup]="form" (ngSubmit)="onSubmit()">
            <fieldset id="kind" class="my-4 pr-5">
                <span class="label">Select the kind of user:</span>
                <ul class="flex flex-wrap gap-y-1 gap-x-8">
                    <li class="inline-block" *ngFor="let userKind of userKinds">
                        <input
                            [id]="'kind-' + userKind"
                            type="radio"
                            name="kind"
                            [value]="userKind"
                            formControlName="kind"
                            class="radio relative float-left"
                        />
                        <label [for]="'kind-' + userKind" class="inline-block pl-[0.5rem] hover:cursor-pointer">{{
                            userKind | userKindLabel
                        }}</label>
                    </li>
                </ul>
            </fieldset>
            <fieldset id="role" class="my-4 pr-5">
                <span class="label">Select the role:</span>
                <ul class="flex flex-wrap gap-y-1 gap-x-8">
                    <li class="inline-block" *ngFor="let userRole of userRoles">
                        <input
                            *appLet="form.controls.kind.value as kind"
                            [id]="'role-' + userRole"
                            type="radio"
                            name="role"
                            [value]="userRole"
                            formControlName="role"
                            class="radio relative float-left"
                        />
                        <label [for]="'role-' + userRole" class="inline-block pl-[0.5rem] hover:cursor-pointer">
                            {{ userRole | userCompanyRoleLabel }}
                        </label>
                    </li>
                </ul>
            </fieldset>
            <ng-container *ngIf="form.controls.kind.value === userKindEnum.ASSOCIATION">
                <fieldset
                    id="associations-field"
                    class="form-control w-full my-4"
                    *appLet="form.controls.associationId as control"
                >
                    <label for="associations" class="my-4"> Select the association: </label>
                    <app-select-single
                        id="associations"
                        [control]="control"
                        [options]="vm.associations | createNewOption: form.controls.role.value === userRoleEnum.ADMIN"
                        [searchKeys]="['name']"
                        bindValue="id"
                        bindLabel="name"
                    ></app-select-single>
                    <span class="text-error mt-1" *ngIf="control.invalid && control.touched">
                        {{ control.errors | formErrorMessage }}
                    </span>
                </fieldset>
            </ng-container>
            <ng-container *ngIf="form.controls.kind.value === userKindEnum.COMPANY">
                <fieldset
                    id="companies-field"
                    class="form-control w-full my-4"
                    *appLet="form.controls.companyId as control"
                >
                    <label for="companies" class="my-4"> Select the company: </label>
                    <app-select-single
                        id="companies"
                        [control]="control"
                        [options]="vm.companies | createNewOption: form.controls.role.value === userRoleEnum.ADMIN"
                        [searchKeys]="['name']"
                        bindValue="id"
                        bindLabel="name"
                    ></app-select-single>
                    <span class="text-error mt-1" *ngIf="control.invalid && control.touched">
                        {{ control.errors | formErrorMessage }}
                    </span>
                </fieldset>
            </ng-container>
            <div class="divider"></div>
            <fieldset id="edit-email" class="form-control w-full my-4" *appLet="form.controls.email as control">
                <label for="email" class="mb-1">Email:</label>
                <input
                    type="email"
                    id="email"
                    name="email"
                    formControlName="email"
                    class="input input-bordered"
                    [class.input-error]="control.invalid && control.touched"
                />
                <span class="text-error mt-1" *ngIf="control.invalid && control.touched">{{
                    form.controls.email.errors | formErrorMessage
                }}</span>
            </fieldset>
            <fieldset id="edit-subject" class="form-control w-full my-4" *appLet="form.controls.subject as control">
                <label for="subject" class="mb-1">Subject:</label>
                <input
                    type="text"
                    id="subject"
                    name="subject"
                    formControlName="subject"
                    class="input input-bordered"
                    [class.input-error]="control.invalid && control.touched"
                />
                <span class="text-error mt-1" *ngIf="control.invalid && control.touched">{{
                    form.controls.subject.errors | formErrorMessage
                }}</span>
            </fieldset>
            <fieldset id="edit-message" class="form-control w-full my-4" *appLet="form.controls.message as control">
                <label for="message" class="mb-1">Message:</label>
                <textarea
                    id="message"
                    name="message"
                    formControlName="message"
                    rows="5"
                    class="textarea textarea-bordered resize-y"
                    [class.textarea-error]="control.invalid && control.touched"
                ></textarea>
                <span class="text-error mt-1" *ngIf="control.invalid && control.touched">{{
                    form.controls.message.errors | formErrorMessage
                }}</span>
            </fieldset>
            <button
                class="btn btn-primary btn-wide float-right"
                type="submit"
                [disabled]="form.invalid || form.pristine || vm.submitting"
            >
                Send
            </button>
        </form>
    </ng-container>
    <ng-template #submittedContainer>
        <div class="py-8 px-4 mx-auto max-w-screen-xl lg:py-16 lg:px-6">
            <div class="mx-auto max-w-screen-sm text-center">
                <p class="mb-8 text-3xl tracking-tight font-bold text-gray-900 md:text-4xl dark:text-white">
                    Invite was sent to {{ form.controls.email.value }}!
                </p>
                <a
                    [routerLink]="['/']"
                    class="inline-flex text-white bg-primary-600 hover:bg-primary-800 focus:ring-4 focus:outline-none focus:ring-primary-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:focus:ring-primary-900 my-4"
                    >Back to Homepage</a
                >
            </div>
        </div>
    </ng-template>
</div>
